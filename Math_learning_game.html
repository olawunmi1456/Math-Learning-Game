<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Fun for Kids</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .game-title {
            color: #1565c0;
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #bbdefb;
        }
        
        .screen {
            display: none;
            padding: 20px;
        }
        
        .active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .btn {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.2rem;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            background-color: #1e88e5;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-level {
            width: 250px;
            text-align: center;
            display: block;
            margin: 15px auto;
            position: relative;
            overflow: hidden;
        }
        
        .level-desc {
            font-size: 0.9rem;
            color: #616161;
            margin-top: 5px;
        }
        
        .question {
            font-size: 2.2rem;
            margin: 30px 0;
            color: #333;
        }
        
        .visual-math {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .math-object {
            width: 50px;
            height: 50px;
            margin: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .option-btn {
            padding: 20px;
            font-size: 1.8rem;
            background-color: #bbdefb;
            border: 3px solid #90caf9;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .option-btn:hover {
            background-color: #90caf9;
            transform: scale(1.05);
        }
        
        .score-display {
            font-size: 1.4rem;
            margin: 20px 0;
            color: #424242;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .stars-container {
            display: flex;
            margin-left: 10px;
        }
        
        .star {
            color: #ffd700;
            font-size: 1.8rem;
            margin: 0 2px;
        }
        
        .progress-container {
            width: 100%;
            background-color: #e3f2fd;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #42a5f5;
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .feedback {
            font-size: 1.6rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: popIn 0.5s;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .correct {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        
        .incorrect {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .game-over {
            font-size: 2.5rem;
            color: #1565c0;
            margin: 20px 0;
        }
        
        .final-score {
            font-size: 3rem;
            color: #ff5722;
            margin: 30px 0;
        }
        
        .message {
            font-size: 1.8rem;
            margin: 20px 0;
            color: #424242;
        }
        
        .sound-control {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #42a5f5;
        }
        
        .timer-container {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            font-size: 1.4rem;
            color: #424242;
        }
        
        .timer {
            margin-left: 10px;
            font-weight: bold;
            color: #1565c0;
        }
        
        .decoration {
            position: absolute;
            z-index: -1;
            opacity: 0.2;
            font-size: 5rem;
            color: #bbdefb;
        }
        
        .decoration-1 {
            top: 50px;
            left: 50px;
        }
        
        .decoration-2 {
            top: 150px;
            right: 70px;
        }
        
        .decoration-3 {
            bottom: 100px;
            left: 80px;
        }
        
        .decoration-4 {
            bottom: 150px;
            right: 60px;
        }
        
        .character {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 4rem;
            transition: transform 0.3s;
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f44336;
            opacity: 0.8;
        }
        
        .hint-btn {
            background-color: #ff9800;
            margin-top: 10px;
        }
        
        .hint-container {
            margin: 15px 0;
            padding: 10px;
            background-color: #fff3e0;
            border-radius: 10px;
            display: none;
        }
        
        .achievement-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #ffd700;
            color: #7b5e0d;
            padding: 10px 15px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.5s;
            z-index: 1000;
        }
        
        .badge-show {
            transform: translateX(0);
        }
        
        .customization-panel {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin: 0 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .color-option.active {
            border: 2px solid #333;
        }
        
        .avatar-option {
            font-size: 2rem;
            margin: 0 10px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            border: 2px solid transparent;
        }
        
        .avatar-option.active {
            border: 2px solid #42a5f5;
            background-color: #bbdefb;
        }
        
        .story-container {
            background-color: #fff9c4;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .story-text {
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .reward-badge {
            width: 80px;
            height: 80px;
            background-color: #ffd700;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px auto;
            font-size: 2.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .reward-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .reward-item {
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            width: 100px;
        }
        
        .reward-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .reward-name {
            font-size: 0.9rem;
        }
        
        .reward-progress {
            height: 5px;
            background-color: #ddd;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .reward-progress-bar {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
        }
        
        .challenge-container {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .challenge-title {
            color: #2e7d32;
            font-size: 1.4rem;
            margin-bottom: 10px;
        }
        
        .challenge-desc {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .challenge-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .challenge-status {
            font-size: 1.1rem;
            font-weight: bold;
            color: #388e3c;
        }
        
        .parent-report {
            background-color: #f3e5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .report-title {
            color: #7b1fa2;
            font-size: 1.4rem;
            margin-bottom: 10px;
        }
        
        .report-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-item {
            padding: 10px;
            background-color: #ede7f6;
            border-radius: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #616161;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4527a0;
        }
        
        .menu-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #616161;
        }
        
        .menu-buttons {
            margin-top: 30px;
        }
        
        .math-object-operation {
            font-size: 2.5rem;
        }
        
        .instruction-item {
            margin: 15px 0;
            font-size: 1.2rem;
        }
        
        .instruction-icon {
            color: #4caf50;
        }
        
        .progress-30 {
            width: 30%;
        }
        
        .progress-60 {
            width: 60%;
        }
        
        .progress-80 {
            width: 80%;
        }
        
        .progress-45 {
            width: 45%;
        }
        
        .progress-70 {
            width: 70%;
        }
        
        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .question {
                font-size: 1.8rem;
            }
            
            .btn-level {
                width: 100%;
                padding: 12px 20px;
            }
            
            .character {
                position: relative;
                bottom: 0;
                right: 0;
                margin-top: 20px;
            }
            
            .timer-container {
                position: relative;
                top: 0;
                left: 0;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            .report-stats {
                grid-template-columns: 1fr;
            }
            
            .decoration {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="sound-control" id="soundToggle">🔊</button>
        
        <div class="timer-container">
            <i class="fas fa-clock"></i>
            <div class="timer" id="timer">60</div>
        </div>
        
        <div class="decoration decoration-1">➕</div>
        <div class="decoration decoration-2">➖</div>
        <div class="decoration decoration-3">✖️</div>
        <div class="decoration decoration-4">➗</div>
        
        <div class="character" id="character">👦</div>
        
        <!-- Menu Screen -->
        <div id="menuScreen" class="screen active">
            <h1 class="game-title">Math Fun for Kids</h1>
            <p class="menu-description">
                Select a difficulty level to start playing!
            </p>
            
            <button class="btn btn-level" data-level="1">
                Level 1: Counting
                <div class="level-desc">Numbers 1-5</div>
            </button>
            
            <button class="btn btn-level" data-level="2">
                Level 2: Simple Addition
                <div class="level-desc">Numbers 1-10</div>
            </button>
            
            <button class="btn btn-level" data-level="3">
                Level 3: Addition & Subtraction
                <div class="level-desc">Numbers 1-15</div>
            </button>
            
            <button class="btn btn-level" data-level="4">
                Level 4: All Operations
                <div class="level-desc">Numbers 1-12</div>
            </button>
            
            <div class="menu-buttons">
                <button class="btn" id="instructionsBtn">
                    <i class="fas fa-info-circle"></i> How to Play
                </button>
                <button class="btn" id="customizeBtn">
                    <i class="fas fa-paint-brush"></i> Customize
                </button>
                <button class="btn" id="rewardsBtn">
                    <i class="fas fa-trophy"></i> Rewards
                </button>
            </div>
        </div>
        
        <!-- Customization Screen -->
        <div id="customizeScreen" class="screen">
            <h2 class="game-title">Customize Your Game</h2>
            
            <div class="customization-panel">
                <h3>Choose Your Character</h3>
                <div class="avatar-options">
                    <span class="avatar-option active" data-avatar="👦">👦</span>
                    <span class="avatar-option" data-avatar="👧">👧</span>
                    <span class="avatar-option" data-avatar="🦁">🦁</span>
                    <span class="avatar-option" data-avatar="🐰">🐰</span>
                    <span class="avatar-option" data-avatar="🐶">🐶</span>
                </div>
                
                <h3>Choose Theme Color</h3>
                <div class="color-options">
                    <span class="color-option active" data-color="#42a5f5"></span>
                    <span class="color-option" data-color="#f44336"></span>
                    <span class="color-option" data-color="#4caf50"></span>
                    <span class="color-option" data-color="#ff9800"></span>
                    <span class="color-option" data-color="#9c27b0"></span>
                </div>
            </div>
            
            <button class="btn" id="backToMenuBtn">
                <i class="fas fa-arrow-left"></i> Back to Menu
            </button>
        </div>
        
        <!-- Rewards Screen -->
        <div id="rewardsScreen" class="screen">
            <h2 class="game-title">Your Rewards</h2>
            
            <div class="reward-badge">
                <i class="fas fa-trophy"></i>
            </div>
            <p class="menu-description">
                Total Stars: <span id="totalStars">0</span>
            </p>
            
            <div class="challenge-container">
                <div class="challenge-title">Weekly Challenge</div>
                <div class="challenge-desc">Solve 50 math problems this week</div>
                <div class="challenge-progress">
                    <div class="progress-container progress-70">
                        <div class="progress-bar progress-30"></div>
                    </div>
                    <div class="challenge-status">15/50</div>
                </div>
            </div>
            
            <div class="reward-container">
                <div class="reward-item">
                    <div class="reward-icon">🏆</div>
                    <div class="reward-name">Math Master</div>
                    <div class="reward-progress">
                        <div class="reward-progress-bar progress-60"></div>
                    </div>
                </div>
                
                <div class="reward-item">
                    <div class="reward-icon">⚡</div>
                    <div class="reward-name">Speedster</div>
                    <div class="reward-progress">
                        <div class="reward-progress-bar progress-30"></div>
                    </div>
                </div>
                
                <div class="reward-item">
                    <div class="reward-icon">🔢</div>
                    <div class="reward-name">Number Ninja</div>
                    <div class="reward-progress">
                        <div class="reward-progress-bar progress-80"></div>
                    </div>
                </div>
                
                <div class="reward-item">
                    <div class="reward-icon">🌟</div>
                    <div class="reward-name">Star Collector</div>
                    <div class="reward-progress">
                        <div class="reward-progress-bar progress-45"></div>
                    </div>
                </div>
            </div>
            
            <button class="btn" id="backToMenuBtn2">
                <i class="fas fa-arrow-left"></i> Back to Menu
            </button>
        </div>
        
        <!-- Instructions Screen -->
        <div id="instructionsScreen" class="screen">
            <h2 class="game-title">How to Play</h2>
            
            <div class="instruction-list">
                <p class="instruction-item">
                    <i class="fas fa-check-circle instruction-icon"></i> 
                    Select a difficulty level to start the game
                </p>
                <p class="instruction-item">
                    <i class="fas fa-check-circle instruction-icon"></i> 
                    Solve math problems by clicking on the correct answer
                </p>
                <p class="instruction-item">
                    <i class="fas fa-check-circle instruction-icon"></i> 
                    Earn stars for correct answers
                </p>
                <p class="instruction-item">
                    <i class="fas fa-check-circle instruction-icon"></i> 
                    Use hints if you get stuck (limited to 3 per game)
                </p>
                <p class="instruction-item">
                    <i class="fas fa-check-circle instruction-icon"></i> 
                    Complete before the timer runs out for bonus points!
                </p>
            </div>
            
            <div class="story-container">
                <h3>Math Adventure Story</h3>
                <p class="story-text">
                    Join Mathy the Monkey on an adventure through Number Jungle! Solve math problems to help Mathy collect bananas and unlock new areas of the jungle. Each correct answer brings you closer to discovering the Ancient Math Temple!
                </p>
            </div>
            
            <button class="btn" id="backToMenuBtn3">
                <i class="fas fa-arrow-left"></i> Back to Menu
            </button>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="score-display">
                Score: <span id="score">0</span>/<span id="totalQuestions">10</span>
                <div class="stars-container" id="starsContainer"></div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="question" id="questionText"></div>
            
            <div class="visual-math" id="visualMath"></div>
            
            <div class="options-container" id="optionsContainer"></div>
            
            <button class="btn hint-btn" id="hintBtn">
                <i class="fas fa-lightbulb"></i> Hint (<span id="hintCount">3</span> left)
            </button>
            
            <div class="hint-container" id="hintContainer"></div>
            
            <div id="feedback" class="feedback"></div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="screen">
            <h2 class="game-over">Game Over!</h2>
            
            <div class="final-score">
                Your score: <span id="finalScore">0</span>/10
            </div>
            
            <div class="score-display">
                Stars earned: 
                <div class="stars-container" id="finalStars"></div>
            </div>
            
            <div class="message" id="resultMessage"></div>
            
            <div class="parent-report">
                <div class="report-title">Progress Report</div>
                <div class="report-stats">
                    <div class="stat-item">
                        <div class="stat-label">Correct Answers</div>
                        <div class="stat-value" id="statCorrect">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Time Spent</div>
                        <div class="stat-value" id="statTime">0s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Hints Used</div>
                        <div class="stat-value" id="statHints">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Stars Earned</div>
                        <div class="stat-value" id="statStars">0</div>
                    </div>
                </div>
            </div>
            
            <button class="btn" id="playAgainBtn">
                <i class="fas fa-redo"></i> Play Again
            </button>
            
            <button class="btn" id="menuBtn">
                <i class="fas fa-home"></i> Main Menu
            </button>
        </div>
    </div>

    <div class="celebration" id="celebration"></div>
    <div class="achievement-badge" id="achievementBadge">New Achievement!</div>

    <!-- Audio elements for sound effects -->
    <audio id="correctSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="wrongSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="levelUpSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="gameOverSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-game-over-470.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="celebrationSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Game variables
        let level = 1;
        let score = 0;
        let currentQuestion = 0;
        const maxQuestions = 10;
        let correctAnswer;
        let options = [];
        let soundEnabled = true;
        let timer;
        let timeLeft = 60;
        let hintsLeft = 3;
        let stars = 0;
        let totalStars = 0;
        let startTime;
        let achievements = {
            perfectScore: false,
            speedRun: false,
            noHintsUsed: false
        };
        
        // DOM elements
        const menuScreen = document.getElementById('menuScreen');
        const instructionsScreen = document.getElementById('instructionsScreen');
        const customizeScreen = document.getElementById('customizeScreen');
        const rewardsScreen = document.getElementById('rewardsScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const questionText = document.getElementById('questionText');
        const visualMath = document.getElementById('visualMath');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackEl = document.getElementById('feedback');
        const scoreEl = document.getElementById('score');
        const totalQuestionsEl = document.getElementById('totalQuestions');
        const finalScoreEl = document.getElementById('finalScore');
        const resultMessageEl = document.getElementById('resultMessage');
        const soundToggle = document.getElementById('soundToggle');
        const timerEl = document.getElementById('timer');
        const progressBar = document.getElementById('progressBar');
        const character = document.getElementById('character');
        const celebration = document.getElementById('celebration');
        const achievementBadge = document.getElementById('achievementBadge');
        const hintBtn = document.getElementById('hintBtn');
        const hintContainer = document.getElementById('hintContainer');
        const hintCountEl = document.getElementById('hintCount');
        const starsContainer = document.getElementById('starsContainer');
        const finalStars = document.getElementById('finalStars');
        const totalStarsEl = document.getElementById('totalStars');
        const statCorrect = document.getElementById('statCorrect');
        const statTime = document.getElementById('statTime');
        const statHints = document.getElementById('statHints');
        const statStars = document.getElementById('statStars');
        
        // Audio elements
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        const levelUpSound = document.getElementById('levelUpSound');
        const gameOverSound = document.getElementById('gameOverSound');
        const clickSound = document.getElementById('clickSound');
        const celebrationSound = document.getElementById('celebrationSound');
        
        // Initialize game
        function init() {
            totalQuestionsEl.textContent = maxQuestions;
            
            // Add event listeners to level buttons
            document.querySelectorAll('.btn-level').forEach(btn => {
                btn.addEventListener('click', () => {
                    playSound(clickSound);
                    level = parseInt(btn.dataset.level);
                    startGame();
                });
            });
            
            // Instructions button
            document.getElementById('instructionsBtn').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(instructionsScreen);
            });
            
            // Customize button
            document.getElementById('customizeBtn').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(customizeScreen);
            });
            
            // Rewards button
            document.getElementById('rewardsBtn').addEventListener('click', () => {
                playSound(clickSound);
                totalStarsEl.textContent = totalStars;
                showScreen(rewardsScreen);
            });
            
            // Back to menu buttons
            document.getElementById('backToMenuBtn').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(menuScreen);
            });
            
            document.getElementById('backToMenuBtn2').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(menuScreen);
            });
            
            document.getElementById('backToMenuBtn3').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(menuScreen);
            });
            
            // Play again button
            document.getElementById('playAgainBtn').addEventListener('click', () => {
                playSound(clickSound);
                startGame();
            });
            
            // Menu button
            document.getElementById('menuBtn').addEventListener('click', () => {
                playSound(clickSound);
                showScreen(menuScreen);
            });
            
            // Hint button
            hintBtn.addEventListener('click', showHint);
            
            // Avatar selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    character.textContent = option.dataset.avatar;
                });
            });
            
            // Color theme selection
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    // Change theme color
                    document.documentElement.style.setProperty('--primary-color', option.dataset.color);
                    document.querySelectorAll('.btn').forEach(btn => {
                        btn.style.backgroundColor = option.dataset.color;
                    });
                });
            });
            
            // Sound toggle
            soundToggle.addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                soundToggle.textContent = soundEnabled ? '🔊' : '🔇';
                localStorage.setItem('mathGameSoundEnabled', soundEnabled);
            });
            
            // Load sound preference from localStorage if available
            const savedSoundPreference = localStorage.getItem('mathGameSoundEnabled');
            if (savedSoundPreference !== null) {
                soundEnabled = savedSoundPreference === 'true';
                soundToggle.textContent = soundEnabled ? '🔊' : '🔇';
            }
            
            // Preload audio files
            preloadAudio();
        }
        
        // Preload audio files to prevent delay on first play
        function preloadAudio() {
            correctSound.volume = 0.7;
            wrongSound.volume = 0.7;
            levelUpSound.volume = 0.7;
            gameOverSound.volume = 0.7;
            clickSound.volume = 0.7;
            celebrationSound.volume = 0.7;
        }
        
        // Start the game
        function startGame() {
            score = 0;
            currentQuestion = 0;
            stars = 0;
            hintsLeft = 3;
            timeLeft = 60;
            scoreEl.textContent = score;
            hintCountEl.textContent = hintsLeft;
            startTime = Date.now();
            updateStars();
            
            // Reset achievements
            achievements = {
                perfectScore: false,
                speedRun: false,
                noHintsUsed: false
            };
            
            showScreen(gameScreen);
            startTimer();
            generateQuestion();
        }
        
        // Start the countdown timer
        function startTimer() {
            clearInterval(timer);
            timerEl.textContent = timeLeft;
            
            timer = setInterval(() => {
                timeLeft--;
                timerEl.textContent = timeLeft;
                
                // Change character expression based on time
                if (timeLeft < 10) {
                    character.textContent = "😰";
                } else if (timeLeft < 30) {
                    character.textContent = "😟";
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }
        
        // Generate a question based on level
        function generateQuestion() {
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            hintContainer.style.display = 'none';
            
            let num1, num2, operation, question;
            
            switch(level) {
                case 1: // Counting
                    num1 = Math.floor(Math.random() * 5) + 1;
                    num2 = Math.floor(Math.random() * 5) + 1;
                    operation = '+';
                    correctAnswer = num1 + num2;
                    question = `How much is ${num1} + ${num2}?`;
                    break;
                    
                case 2: // Simple addition
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * 10) + 1;
                    operation = '+';
                    correctAnswer = num1 + num2;
                    question = `${num1} + ${num2} = ?`;
                    break;
                    
                case 3: // Addition and subtraction
                    operation = Math.random() > 0.5 ? '+' : '-';
                    
                    if (operation === '+') {
                        num1 = Math.floor(Math.random() * 15) + 1;
                        num2 = Math.floor(Math.random() * 15) + 1;
                        correctAnswer = num1 + num2;
                        question = `${num1} + ${num2} = ?`;
                    } else {
                        // Ensure no negative answers by making num1 larger than num2
                        num1 = Math.floor(Math.random() * 15) + 1;
                        num2 = Math.floor(Math.random() * num1) + 1;
                        correctAnswer = num1 - num2;
                        question = `${num1} - ${num2} = ?`;
                    }
                    break;
                    
                case 4: // All operations
                    const operations = ['+', '-', '×'];
                    operation = operations[Math.floor(Math.random() * operations.length)];
                    
                    if (operation === '+') {
                        num1 = Math.floor(Math.random() * 12) + 1;
                        num2 = Math.floor(Math.random() * 12) + 1;
                        correctAnswer = num1 + num2;
                        question = `${num1} + ${num2} = ?`;
                    } else if (operation === '-') {
                        // Ensure no negative answers
                        num1 = Math.floor(Math.random() * 12) + 1;
                        num2 = Math.floor(Math.random() * num1) + 1;
                        correctAnswer = num1 - num2;
                        question = `${num1} - ${num2} = ?`;
                    } else {
                        num1 = Math.floor(Math.random() * 12) + 1;
                        num2 = Math.floor(Math.random() * 12) + 1;
                        correctAnswer = num1 * num2;
                        question = `${num1} × ${num2} = ?`;
                    }
                    break;
            }
            
            questionText.textContent = question;
            generateVisualMath(num1, num2, operation);
            generateOptions();
            
            // Update progress bar
            progressBar.style.width = `${(currentQuestion / maxQuestions) * 100}%`;
        }
        
        // Generate visual representation of the math problem
        function generateVisualMath(num1, num2, operation) {
            visualMath.innerHTML = '';
            
            // Map operation symbols
            const opSymbols = {
                '+': '+',
                '-': '-',
                '×': '×'
            };
            
            // Create visual elements for the first number
            for (let i = 0; i < num1; i++) {
                const elem = document.createElement('div');
                elem.className = 'math-object';
                elem.textContent = '🔵';
                visualMath.appendChild(elem);
            }
            
            // Add operation symbol
            const opElem = document.createElement('div');
            opElem.className = 'math-object math-object-operation';
            opElem.textContent = opSymbols[operation];
            visualMath.appendChild(opElem);
            
            // Create visual elements for the second number
            for (let i = 0; i < num2; i++) {
                const elem = document.createElement('div');
                elem.className = 'math-object';
                elem.textContent = '🔵';
                visualMath.appendChild(elem);
            }
            
            // Add equals sign
            const equalsElem = document.createElement('div');
            equalsElem.className = 'math-object math-object-operation';
            equalsElem.textContent = '=';
            visualMath.appendChild(equalsElem);
            
            // Add question mark
            const questionElem = document.createElement('div');
            questionElem.className = 'math-object math-object-operation';
            questionElem.textContent = '?';
            visualMath.appendChild(questionElem);
        }
        
        // Generate options for the current question
        function generateOptions() {
            options = [correctAnswer];
            
            // Generate 3 wrong answers
            while (options.length < 4) {
                let variation = Math.floor(Math.random() * 5) + 1;
                if (Math.random() > 0.5) variation = -variation;
                
                const wrongAnswer = correctAnswer + variation;
                
                // Ensure wrong answers are positive and not duplicates
                if (wrongAnswer > 0 && wrongAnswer !== correctAnswer && !options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // Shuffle options
            options.sort(() => Math.random() - 0.5);
            
            // Display options
            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.addEventListener('click', () => checkAnswer(option));
                optionsContainer.appendChild(button);
            });
        }
        
        // Show a hint for the current question
        function showHint() {
            if (hintsLeft <= 0) return;
            
            playSound(clickSound);
            hintsLeft--;
            hintCountEl.textContent = hintsLeft;
            
            // Disable hint button if no hints left
            if (hintsLeft <= 0) {
                hintBtn.disabled = true;
                hintBtn.style.opacity = '0.5';
            }
            
            // Show hint
            hintContainer.style.display = 'block';
            hintContainer.innerHTML = `
                <p><i class="fas fa-lightbulb" style="color: #ff9800;"></i> 
                Try selecting ${correctAnswer}. Count the circles if you need help!</p>
            `;
            
            // Track achievement
            achievements.noHintsUsed = false;
        }
        
        // Check if the selected answer is correct
        function checkAnswer(selectedAnswer) {
            playSound(clickSound);
            
            // Disable option buttons after selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
            });
            
            if (selectedAnswer === correctAnswer) {
                score++;
                scoreEl.textContent = score;
                feedbackEl.textContent = 'Correct! Well done!';
                feedbackEl.className = 'feedback correct';
                playSound(correctSound);
                
                // Add time bonus for quick answers
                if (timeLeft > 40) {
                    timeLeft += 5;
                    timerEl.textContent = timeLeft;
                    feedbackEl.textContent += ' +5 time bonus!';
                }
                
                // Add star for correct answer
                stars++;
                totalStars++;
                updateStars();
                
                // Happy character
                character.textContent = "😄";
                
                // Celebration for perfect answers
                if (stars % 3 === 0) {
                    createCelebration();
                }
            } else {
                feedbackEl.textContent = `Oops! The answer was ${correctAnswer}`;
                feedbackEl.className = 'feedback incorrect';
                playSound(wrongSound);
                
                // Sad character
                character.textContent = "😢";
            }
            
            // Move to next question or end game
            currentQuestion++;
            if (currentQuestion < maxQuestions) {
                setTimeout(generateQuestion, 1500);
            } else {
                setTimeout(endGame, 1500);
            }
        }
        
        // Update stars display
        function updateStars() {
            starsContainer.innerHTML = '';
            for (let i = 0; i < stars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = '<i class="fas fa-star"></i>';
                starsContainer.appendChild(star);
            }
        }
        
        // Create celebration animation
        function createCelebration() {
            playSound(celebrationSound);
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                
                // Add keyframes for fall animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fall {
                        to {
                            transform: translateY(100vh) rotate(${Math.random() * 360}deg);
                        }
                    }
                `;
                document.head.appendChild(style);
                
                celebration.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
            
            // Show achievement if applicable
            if (stars === 5) {
                showAchievement("Star Collector!");
            } else if (stars === 10) {
                showAchievement("Math Master!");
            }
        }
        
        // Show achievement badge
        function showAchievement(text) {
            achievementBadge.textContent = text;
            achievementBadge.classList.add('badge-show');
            
            setTimeout(() => {
                achievementBadge.classList.remove('badge-show');
            }, 3000);
        }
        
        // End the game and show results
        function endGame() {
            clearInterval(timer);
            
            finalScoreEl.textContent = score;
            
            // Set final stars
            finalStars.innerHTML = '';
            for (let i = 0; i < stars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = '<i class="fas fa-star"></i>';
                finalStars.appendChild(star);
            }
            
            // Calculate time spent
            const timeSpent = Math.floor((Date.now() - startTime) / 1000);
            
            // Update stats
            statCorrect.textContent = `${score}/${maxQuestions}`;
            statTime.textContent = `${timeSpent}s`;
            statHints.textContent = 3 - hintsLeft;
            statStars.textContent = stars;
            
            // Check achievements
            if (score === maxQuestions) {
                achievements.perfectScore = true;
            }
            
            if (timeLeft > 30) {
                achievements.speedRun = true;
            }
            
            if (hintsLeft === 3) {
                achievements.noHintsUsed = true;
            }
            
            // Set message based on score
            if (score === maxQuestions) {
                resultMessageEl.textContent = 'Perfect! You\'re a math superstar! 🌟';
                resultMessageEl.style.color = '#2e7d32';
                
                // Show special celebration for perfect score
                createCelebration();
                showAchievement("Perfect Score!");
            } else if (score >= maxQuestions * 0.7) {
                resultMessageEl.textContent = 'Great job! You\'re doing excellent!';
                resultMessageEl.style.color = '#42a5f5';
            } else if (score >= maxQuestions * 0.5) {
                resultMessageEl.textContent = 'Good effort! Keep practicing!';
                resultMessageEl.style.color = '#ff9800';
            } else {
                resultMessageEl.textContent = 'Nice try! Practice makes perfect!';
                resultMessageEl.style.color = '#f44336';
            }
            
            // Add achievement messages
            if (achievements.perfectScore) {
                resultMessageEl.innerHTML += '<br><i class="fas fa-trophy"></i> Perfect Score Achievement!';
            }
            
            if (achievements.speedRun) {
                resultMessageEl.innerHTML += '<br><i class="fas fa-bolt"></i> Speed Runner Achievement!';
            }
            
            if (achievements.noHintsUsed) {
                resultMessageEl.innerHTML += '<br><i class="fas fa-lightbulb"></i> No Hints Used Achievement!';
            }
            
            playSound(gameOverSound);
            showScreen(gameOverScreen);
        }
        
        // Show a specific screen
        function showScreen(screen) {
            menuScreen.classList.remove('active');
            instructionsScreen.classList.remove('active');
            customizeScreen.classList.remove('active');
            rewardsScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            gameOverScreen.classList.remove('active');
            
            screen.classList.add('active');
        }
        
        // Play a sound if enabled
        function playSound(sound) {
            if (soundEnabled) {
                sound.currentTime = 0;
                sound.play().catch(e => {
                    console.log("Audio play failed:", e);
                });
            }
        }
        
        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
